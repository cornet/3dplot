<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>3dplot: display.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>display.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * display.c</span>
00003 <span class="comment"> */</span>
00004 
00005 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00007 
00008 <span class="preprocessor">#if defined(__APPLE__) &amp;&amp; defined(__MACH__)</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#include &lt;GLUT/glut.h&gt;</span>
00010 <span class="preprocessor">#else</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#include &lt;GL/glut.h&gt;</span>
00012 <span class="preprocessor">#endif</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "<a class="code" href="main_8h.html">main.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="control_8h.html">control.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="graph_8h.html">graph.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="display_8h.html">display.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="savegraph_8h.html">savegraph.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="lights_8h.html">lights.h</a>"</span>
00020 
00021 
00022 <span class="keywordtype">void</span> initDisplay(<span class="keywordtype">void</span>)
00023 {   
00024     <span class="keyword">extern</span> <span class="keywordtype">float</span> Camera[3];
00025     <span class="keyword">extern</span> <span class="keywordtype">float</span> Centre[3];
00026     <span class="keyword">extern</span> <span class="keywordtype">float</span> UpVector[3];
00027     
00028     <span class="keyword">extern</span> <span class="keywordtype">int</span> FLAT_SHADING;
00029     <span class="keyword">extern</span> <span class="keywordtype">int</span> WINDOW_SIZE;
00030     <span class="keyword">extern</span> <span class="keywordtype">int</span> Width;
00031     <span class="keyword">extern</span> <span class="keywordtype">int</span> Height;
00032     
00033     <span class="comment">/* Initialise Window */</span>
00034     glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);
00035     <span class="keywordflow">if</span> (WINDOW_SIZE ==1) {
00036         glutInitWindowSize(Width, Height);
00037     } <span class="keywordflow">else</span> {
00038         glutInitWindowSize(DEF_WIN_WIDTH, DEF_WIN_HEIGHT);
00039     }
00040     glutInitWindowPosition(DEF_WIN_X_POS, DEF_WIN_Y_POS);
00041     glutCreateWindow(<span class="stringliteral">"3dPlot"</span>);
00042 
00043     <span class="comment">/* Clear Background */</span>
00044     glShadeModel(GL_SMOOTH);
00045     glClearColor(0.0, 0.0, 0.0, 0.0);
00046 
00047     glMatrixMode(GL_PROJECTION);
00048     
00049     gluLookAt(Camera[0], Camera[1], Camera[2],
00050             Centre[0], Centre[1], Centre[2],
00051             UpVector[0], UpVector[1], UpVector[2]);
00052 
00053     glLoadIdentity();
00054 
00055     <span class="keywordflow">if</span> (FLAT_SHADING == 1) {
00056         glShadeModel(GL_FLAT);
00057     } <span class="keywordflow">else</span> {
00058         glShadeModel(GL_SMOOTH);
00059     }
00060 }
00061 
00062 <span class="keywordtype">void</span> setCameraDefaults(<span class="keywordtype">void</span>)
00063 {   
00064     <span class="keyword">extern</span> <span class="keywordtype">float</span> Camera[3];
00065     <span class="keyword">extern</span> <span class="keywordtype">float</span> Centre[3];
00066     <span class="keyword">extern</span> <span class="keywordtype">float</span> UpVector[3];
00067 
00068     <span class="keyword">extern</span> <span class="keywordtype">int</span> SET_CAMERA_PLACEMENT;
00069     <span class="keyword">extern</span> <span class="keywordtype">float</span> CameraPlacement[6];
00070     <span class="keywordtype">int</span> i;
00071 
00072     <span class="comment">/* Init gluLookAt */</span>
00073     <span class="keywordflow">if</span> (SET_CAMERA_PLACEMENT == 1) {
00074         Camera[0] = CameraPlacement[0];
00075         Camera[1] = CameraPlacement[1];
00076         Camera[2] = CameraPlacement[2];
00077         Centre[0] = CameraPlacement[3];
00078         Centre[1] = CameraPlacement[4];
00079         Centre[2] = CameraPlacement[5];
00080         UpVector[0] = CameraPlacement[6]; 
00081         UpVector[1] = CameraPlacement[7];
00082         UpVector[2] = CameraPlacement[8];
00083     } <span class="keywordflow">else</span> {
00084         Camera[0] = <a class="code" href="display_8h.html#a20a4">CAMX</a>;
00085         Camera[1] = <a class="code" href="display_8h.html#a20a5">CAMY</a>;
00086         Camera[2] = <a class="code" href="display_8h.html#a20a6">CAMZ</a>;
00087         Centre[0] = <a class="code" href="display_8h.html#a20a7">CENTREX</a>;
00088         Centre[1] = <a class="code" href="display_8h.html#a20a8">CENTREY</a>;
00089         Centre[2] = <a class="code" href="display_8h.html#a20a9">CENTREZ</a>;
00090         UpVector[0] = <a class="code" href="display_8h.html#a20a10">UPVECTORX</a>; 
00091         UpVector[1] = <a class="code" href="display_8h.html#a20a11">UPVECTORY</a>;
00092         UpVector[2] = <a class="code" href="display_8h.html#a20a12">UPVECTORZ</a>;
00093     }
00094 
00095     <span class="comment">/* Set initial Coords */</span>
00096     updateSphericalCoords();
00097     
00098 }
00099 
00100 <span class="keywordtype">void</span> drawAxis(<span class="keywordtype">void</span>)
00101 {
00102     <span class="keyword">extern</span> <span class="keywordtype">int</span> AXIS_DEFINED;
00103     <span class="keyword">extern</span> <span class="keywordtype">float</span> Axis[6];
00104 
00105     <span class="comment">/* Set axis colour */</span>
00106     glColor3d(1.0, 1.0, 1.0);
00107     <span class="keywordflow">if</span> (AXIS_DEFINED == 1) {        
00108 
00109         glBegin(GL_LINES);    
00110         <span class="comment">/* x-axis */</span>
00111         glVertex3d(Axis[0], 0.0, 0.0);
00112         glVertex3d(Axis[1], 0.0, 0.0);
00113 
00114         <span class="comment">/* y-axis */</span>
00115         glVertex3d(0.0, Axis[2], 0.0);
00116         glVertex3d(0.0, Axis[3], 0.0);
00117 
00118         <span class="comment">/* z-axis */</span>
00119         glVertex3d(0.0, 0.0, Axis[4]);
00120         glVertex3d(0.0, 0.0, Axis[5]);
00121         glEnd(); <span class="comment">/* GL_LINES */</span>
00122 
00123     } <span class="keywordflow">else</span> {
00124         glBegin(GL_LINES);    
00125         <span class="comment">/* x-axis */</span>
00126         glVertex3d(-1.25, 0.0, 0.0);
00127         glVertex3d(1.25, 0.0, 0.0);
00128 
00129         <span class="comment">/* y-axis */</span>
00130         glVertex3d(0.0, -1.25, 0.0);
00131         glVertex3d(0.0, 1.25, 0.0);
00132 
00133         <span class="comment">/* z-axis */</span>
00134         glVertex3d(0.0, 0.0, -1.25);
00135         glVertex3d(0.0, 0.0, 1.25);
00136         glEnd(); <span class="comment">/* GL_LINES */</span>
00137     }
00138 
00139     glFlush();
00140 }
00141 
00142 <span class="keywordtype">void</span> drawGraph(<span class="keyword">struct</span> <a class="code" href="structdataset.html">dataset</a> *ds)
00143 {
00144     <span class="keyword">extern</span> GLuint *ThePlot;
00145 
00146     ThePlot = malloc(<span class="keyword">sizeof</span>(GLuint));
00147 
00148     ThePlot[0] = glGenLists(1);
00149     glNewList(ThePlot[0], GL_COMPILE);
00150     plotGraph(ds);
00151     glEndList();
00152 
00153 }
00154 
00155 <span class="keywordtype">void</span> reshape(<span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h )
00156 {
00157     <span class="keyword">extern</span> <span class="keywordtype">float</span> Camera[3];
00158     <span class="keyword">extern</span> <span class="keywordtype">float</span> Centre[3];
00159     <span class="keyword">extern</span> <span class="keywordtype">float</span> UpVector[3];
00160 
00161     <span class="comment">/* Prevent divide by zero error if window too small */</span>
00162     <span class="keywordflow">if</span>(h == 0) {
00163         h = 1;
00164     };
00165 
00166     <span class="comment">/* Set Viewport to be entire window */</span>
00167     glViewport(0, 0, (GLsizei) w, (GLsizei) h);
00168 
00169     <span class="comment">/* Reset the coordinate system before modifying */</span>
00170     glMatrixMode(GL_PROJECTION);
00171     glLoadIdentity();
00172 
00173     <span class="comment">/* Set the correct perspective */</span>
00174     gluPerspective(45, w/h, 1, 1000);
00175     glMatrixMode(GL_MODELVIEW);
00176     glLoadIdentity();
00177     gluLookAt(Camera[0], Camera[1], Camera[2],
00178             Centre[0], Centre[1], Centre[2],
00179             UpVector[0], UpVector[1], UpVector[2]);
00180 }
00181 
00182 <span class="keywordtype">void</span> renderGraph(<span class="keywordtype">void</span>)
00183 {
00184     <span class="keyword">extern</span> GLuint *ThePlot;
00185     <span class="keyword">extern</span> <span class="keywordtype">int</span> OUTPUT;
00186     <span class="keyword">extern</span> <span class="keywordtype">char</span> *OutputFile;
00187 
00188     <span class="keyword">extern</span> <span class="keywordtype">int</span> PLACE_LIGHT;
00189     <span class="keyword">extern</span> <span class="keywordtype">float</span> LightDetails[3];
00190 
00191     glClearDepth(1.0);
00192     glClear(GL_COLOR_BUFFER_BIT|  GL_DEPTH_BUFFER_BIT);
00193 
00194     <span class="keywordflow">if</span> (PLACE_LIGHT == 1) {
00195         addLight(LightDetails[0], LightDetails[1], LightDetails[2]);
00196         printf(<span class="stringliteral">"Light: %f, %f, %f\n"</span>, LightDetails[0], LightDetails[1], LightDetails[2]);
00197         <span class="comment">/* Prevent it trying to place same light again! */</span>
00198         PLACE_LIGHT=0;
00199     }
00200 
00201     drawAxis();
00202 
00203     glCallList(ThePlot[0]);
00204     glutSwapBuffers();
00205     glFlush();
00206 
00207 
00208     <span class="keywordflow">if</span> (OUTPUT ==1) {
00209         printf(<span class="stringliteral">"Saving Graph\n"</span>);
00210         saveGraph(OutputFile);
00211         exit(0);
00212     }
00213 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon May 3 15:20:15 2004 for 3dplot by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
