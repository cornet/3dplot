<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>3dplot: main.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>main.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *  main.c</span>
00003 <span class="comment"> *  3dplot</span>
00004 <span class="comment"> */</span>
00005 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00007 <span class="preprocessor">#include &lt;string.h&gt;</span>
00008 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00009 
00010 <span class="preprocessor">#include "<a class="code" href="main_8h.html">main.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="display_8h.html">display.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="control_8h.html">control.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="file_8h.html">file.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="graph_8h.html">graph.h</a>"</span>
00015 
00016 <span class="comment">/*#include "screenshot.h" */</span>
00017 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="movie_8h.html">movie.h</a>"</span>
00019 
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> * Global Vairables</span>
00023 <span class="comment"> * This is the ONLY place global variables should be declared</span>
00024 <span class="comment"> */</span>
00025 
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> * Hold argv and argc stuff,</span>
00029 <span class="comment"> * Needs to be passed to gl init function</span>
00030 <span class="comment"> */</span>
00031 <span class="keywordtype">int</span> Argc;
00032 <span class="keywordtype">char</span> **Argv;
00033 
00034 <span class="comment">/* </span>
00035 <span class="comment"> * Coordinates Used By glLookAt()</span>
00036 <span class="comment"> * Camera[3] : x,y,z coodinates of camera</span>
00037 <span class="comment"> * Centre[3] : global coodinates of centre of viewport</span>
00038 <span class="comment"> * UpVector[3] : Defines the upward direction of the camera</span>
00039 <span class="comment"> */</span>
00040 <span class="keywordtype">float</span> Camera[3];
00041 <span class="keywordtype">float</span> Centre[3];
00042 <span class="keywordtype">float</span> UpVector[3];
00043 
00044 <span class="comment">/*</span>
00045 <span class="comment"> * Spherical Coordinates used for movement</span>
00046 <span class="comment"> * Radius</span>
00047 <span class="comment"> * Theta - Longitudinal Angle</span>
00048 <span class="comment"> * Phi - Lateral Angle</span>
00049 <span class="comment"> */</span>
00050 <span class="keywordtype">float</span> Radius; 
00051 <span class="keywordtype">float</span> Theta;  <span class="comment">/* Longitudinal Angle */</span>
00052 <span class="keywordtype">float</span> Phi;    <span class="comment">/* Lateral Angle      */</span>
00053 
00054 <span class="comment">/*</span>
00055 <span class="comment"> * Scale factors...</span>
00056 <span class="comment"> * Hold Max and Min vals of data</span>
00057 <span class="comment"> * Gained from first frame, need to kept same for </span>
00058 <span class="comment"> * rest of frames</span>
00059 <span class="comment"> */</span>
00060 <span class="keywordtype">int</span> FIRST_FRAME=1;
00061 <span class="keywordtype">float</span> MaxVal;
00062 <span class="keywordtype">float</span> MinVal;
00063 
00064 <span class="comment">/*</span>
00065 <span class="comment"> * Flags and Variables passed from command line</span>
00066 <span class="comment"> */</span>
00067 FILE *ConfigFile;
00068 
00069 <span class="keywordtype">int</span> COLOUR=0;
00070 <span class="keywordtype">float</span> Colour[3];
00071 
00072 <span class="keywordtype">int</span> USE_GRADIENT_FILL=0;
00073 <span class="keywordtype">float</span> GradientDetails[6];
00074 
00075 <span class="keywordtype">int</span> WINDOW_SIZE=0;
00076 <span class="keywordtype">int</span> Width;
00077 <span class="keywordtype">int</span> Height;
00078 
00079 <span class="keywordtype">int</span> FLAT_SHADING=0;
00080 
00081 <span class="keywordtype">int</span> WIREFRAME=0;
00082 
00083 <span class="keywordtype">int</span> OUTPUT=0;
00084 <span class="keywordtype">char</span> *OutputFile;
00085 
00086 <span class="keywordtype">int</span> SAVE_MOVIE=0;
00087 <span class="keywordtype">char</span> *MovieBaseDir;
00088 
00089 <span class="keywordtype">int</span> MOVIE=0;
00090 <span class="keywordtype">char</span> *MovieBaseDir;
00091 <span class="keywordtype">char</span> *FrameList;
00092 <span class="keywordtype">int</span> NumOfFrames;            <span class="comment">/* Holds the number of frames in the plot */</span>
00093 
00094 <span class="keywordtype">int</span> PLACE_LIGHT=0;
00095 <span class="keywordtype">float</span> LightDetails[3];
00096 
00097 <span class="keywordtype">int</span> AXIS_DEFINED=0;
00098 <span class="keywordtype">float</span> Axis[6];
00099 
00100 <span class="keywordtype">int</span> SET_CAMERA_PLACEMENT=0;
00101 <span class="keywordtype">float</span> CameraPlacement[9];
00102 
00103 <span class="keywordtype">int</span> VERBOSE=0;
00104 
00105 GLuint *ThePlot;        <span class="comment">/* Holds the Display list for the plot    */</span>
00106 
00107 <span class="keywordtype">int</span> expandFloatOption(<span class="keywordtype">float</span> *values, <span class="keywordtype">char</span> *string)
00108 {
00109     <span class="keywordtype">int</span> length;
00110     <span class="keywordtype">int</span> i,j,k;
00111     <span class="keywordtype">char</span> buf[6];
00112 
00113     length = strlen(string);
00114 
00115     <span class="keywordflow">for</span> (j=0; j&lt;6; j++) {
00116         buf[j] = <span class="charliteral">'\0'</span>;
00117     }
00118 
00119     i=0; j=0; k=0;
00120     <span class="keywordflow">while</span>(i&lt;length) {
00121         <span class="keywordflow">if</span>(string[i] == <span class="charliteral">','</span>) {
00122             i++;
00123             values[k] = atof(buf);
00124             <span class="keywordflow">for</span> (j=0; j&lt;6; j++) {
00125                 buf[j] = <span class="charliteral">'\0'</span>;
00126             }
00127             j=0;
00128             k++;
00129         } <span class="keywordflow">else</span> {
00130             buf[j] = string[i];
00131             i++; j++;
00132         }
00133         printf(<span class="stringliteral">"i = %d \n"</span>,i); 
00134     }
00135 
00136     <span class="comment">/* Get final one */</span>
00137     values[k] = atoi(buf);
00138     <span class="keywordflow">return</span> 0;
00139 }       
00140 
00141 <span class="keywordtype">int</span> expandIntOption(<span class="keywordtype">int</span> *values, <span class="keywordtype">char</span> *string)
00142 {
00143     <span class="keywordtype">int</span> length;
00144     <span class="keywordtype">int</span> i,j,k;
00145     <span class="keywordtype">char</span> buf[6];
00146 
00147     length = strlen(string);
00148 
00149     <span class="keywordflow">for</span> (j=0; j&lt;6; j++) {
00150         buf[j] = <span class="charliteral">'\0'</span>;
00151     }
00152 
00153     i=0; j=0; k=0;
00154     <span class="keywordflow">while</span>(i&lt;length) {
00155         <span class="keywordflow">if</span>(string[i] == <span class="charliteral">','</span>) {
00156             i++;
00157             values[k] = atoi(buf);
00158             <span class="keywordflow">for</span> (j=0; j&lt;6; j++) {
00159                 buf[j] = <span class="charliteral">'\0'</span>;
00160             }
00161             j=0;
00162             k++;
00163         } <span class="keywordflow">else</span> {
00164             buf[j] = string[i];
00165             i++; j++;
00166         }
00167         printf(<span class="stringliteral">"i = %d \n"</span>,i); 
00168     }
00169 
00170     <span class="comment">/* Get final one */</span>
00171     values[k] = atoi(buf);
00172     <span class="keywordflow">return</span> 0;
00173 }
00174 
00175 <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00176 {
00177     FILE *fh; 
00178     <span class="keyword">struct </span><a class="code" href="structdataset.html">dataset</a> *ds;
00179     <span class="keyword">struct </span><a class="code" href="structframe.html">frame</a> *frames;
00180     <span class="keywordtype">int</span> argch;
00181     <span class="keywordtype">int</span> i;
00182 
00183     <span class="comment">/* Command line vars */</span>
00184     <span class="keywordtype">int</span> size[2];
00185 
00186 
00187     Argc = argc;
00188     Argv = argv;
00189     
00190     <span class="comment">/* Read command Line Args */</span>
00191     <span class="keywordflow">while</span> ((argch = getopt(argc, argv, <span class="stringliteral">"c:C:g:s:fwo:O:m:hl:t:a:vV"</span>)) != -1) {
00192         <span class="keywordflow">switch</span> (argch) {
00193             <span class="keywordflow">case</span> <span class="charliteral">'c'</span>: <span class="comment">/* Read Config File */</span>
00194                 ConfigFile = fopen(optarg, <span class="stringliteral">"r"</span>);
00195                 readConfigFile(ConfigFile);
00196                 fclose(ConfigFile);
00197                 <span class="keywordflow">break</span>;
00198                 
00199             <span class="keywordflow">case</span> <span class="charliteral">'C'</span>: <span class="comment">/* Set Graph Colour */</span>
00200                 COLOUR=1;
00201                 expandFloatOption(Colour, optarg);
00202                 <span class="comment">/* Scale to between 0 and 1 */</span>
00203                 <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {
00204                     Colour[i] = Colour[i]/255;
00205                 }
00206                 <span class="keywordflow">break</span>;
00207                 
00208             <span class="keywordflow">case</span> <span class="charliteral">'s'</span>: <span class="comment">/* Set window Geometry */</span>
00209                 WINDOW_SIZE =1;
00210                 expandIntOption(size, optarg);
00211                 Width = size[0];    
00212                 Height = size[1];
00213                 <span class="keywordflow">break</span>;
00214                 
00215             <span class="keywordflow">case</span> <span class="charliteral">'g'</span>: <span class="comment">/* Do Gradient\heightmap Render */</span>
00216                 USE_GRADIENT_FILL=1;
00217                 expandFloatOption(GradientDetails, optarg); 
00218                 <span class="comment">/* Scale */</span>
00219                 <span class="keywordflow">for</span> (i=0; i&lt;6; i++) {
00220                     GradientDetails[i] = GradientDetails[i]/255;
00221                 }
00222                 <span class="keywordflow">break</span>;
00223 
00224             <span class="keywordflow">case</span> <span class="charliteral">'f'</span>: <span class="comment">/* Use Flat shading */</span>
00225                 FLAT_SHADING=1;
00226                 <span class="keywordflow">break</span>;
00227 
00228             <span class="keywordflow">case</span> <span class="charliteral">'w'</span>: <span class="comment">/* Render Wireframe Model */</span>
00229                 WIREFRAME=1;
00230                 <span class="keywordflow">break</span>;
00231             
00232             <span class="keywordflow">case</span> <span class="charliteral">'o'</span>: <span class="comment">/* Output to file */</span>
00233                 OUTPUT=1;
00234                 OutputFile = malloc(<span class="keyword">sizeof</span>(optarg)+<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00235                 strcpy(OutputFile, optarg);
00236                 <span class="keywordflow">break</span>;
00237             
00238             <span class="keywordflow">case</span> <span class="charliteral">'O'</span>: <span class="comment">/* Set Movie output dir */</span>
00239                 SAVE_MOVIE=1;
00240                 MovieBaseDir = malloc(<span class="keyword">sizeof</span>(optarg)+<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00241                 strcpy(MovieBaseDir, optarg);
00242                 <span class="keywordflow">break</span>;
00243                 
00244             <span class="keywordflow">case</span> <span class="charliteral">'m'</span>: <span class="comment">/* Render Movie */</span>
00245                 MOVIE=1;
00246                 FrameList = malloc(<span class="keyword">sizeof</span>(optarg)+<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00247                 strcpy(FrameList, optarg);
00248                 printf(<span class="stringliteral">"FrameList is %s\n"</span>, FrameList);
00249                 <span class="keywordflow">break</span>;
00250             
00251             <span class="keywordflow">case</span> <span class="charliteral">'l'</span>: <span class="comment">/* Place a light */</span>
00252                 PLACE_LIGHT=1;
00253                 expandFloatOption(LightDetails, optarg);
00254                 <span class="keywordflow">break</span>;
00255             
00256             <span class="keywordflow">case</span> <span class="charliteral">'a'</span>: <span class="comment">/* Set up axis */</span>
00257                 AXIS_DEFINED=1;
00258                 expandFloatOption(Axis, optarg);
00259                 <span class="keywordflow">break</span>;
00260                 
00261             <span class="keywordflow">case</span> <span class="charliteral">'t'</span>: <span class="comment">/* Set Camera Placement */</span>
00262                 SET_CAMERA_PLACEMENT=1;
00263                 expandFloatOption(CameraPlacement, optarg);
00264                 <span class="keywordflow">break</span>;
00265 
00266             <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: <span class="comment">/* Verbose Mode */</span>
00267                 VERBOSE = 1;
00268                 <span class="keywordflow">break</span>;
00269                 
00270             <span class="keywordflow">case</span> <span class="charliteral">'h'</span>: <span class="comment">/* Show Help */</span>
00271                 <span class="keywordflow">break</span>;
00272                 
00273             <span class="keywordflow">case</span> <span class="charliteral">'V'</span>: <span class="comment">/* Show Version */</span>
00274                 printf(<span class="stringliteral">"3dplot v0.1\n"</span>);
00275                 <span class="keywordflow">return</span> 0;
00276                 <span class="keywordflow">break</span>;
00277 
00278             <span class="keywordflow">default</span>:
00279                 <span class="keywordflow">break</span>;
00280         }
00281     }
00282 
00283     <span class="keywordflow">if</span> (MOVIE==1) {
00284         printf(<span class="stringliteral">"Rendering the movie from list %s\n"</span>, FrameList);
00285         frames = readFrames(FrameList);
00286 
00287         renderFrames(frames);
00288         glutDisplayFunc(saveMovie);
00289         glutReshapeFunc(reshape);
00290         glutMainLoop();
00291         <span class="keywordflow">return</span> 0;
00292     }
00293 
00294     <span class="comment">/* Parse any other args, i.e. the files */</span>
00295     <span class="keywordflow">if</span> (optind &lt; argc) {
00296         printf(<span class="stringliteral">"File is %s \n"</span>, argv[optind]);
00297         fh = fopen(argv[optind], <span class="stringliteral">"r"</span>);
00298         ds = readDataFile(fh);
00299     } <span class="keywordflow">else</span> {
00300             printf(<span class="stringliteral">"No file specified\n"</span>);
00301             <span class="keywordflow">return</span> 0;
00302     }       
00303 
00304 
00305     glutInit(&amp;argc, argv);
00306     initDisplay();
00307     setCameraDefaults();
00308 
00309     glutDisplayFunc(renderGraph);
00310     glutReshapeFunc(reshape);
00311     glutKeyboardFunc(processNormalKeys);
00312     glutSpecialFunc(processSpecialKeys);
00313 
00314     drawGraph(ds);
00315     
00316     glutMainLoop();
00317 
00318     <span class="keywordflow">return</span> 0;
00319 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon May 3 15:20:15 2004 for 3dplot by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
